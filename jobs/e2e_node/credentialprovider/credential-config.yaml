#cloud-config

write_files:
  - path: /etc/kubernetes/kubelet-image-credential.yaml
    permissions: '0644'
    owner: root
    content: |
      kind: CredentialProviderConfig
      apiVersion: kubelet.config.k8s.io/v1alpha1
      providers:
        - name: auth-provider-gcp
          apiVersion: credentialprovider.kubelet.k8s.io/v1alpha1
          matchImages:
          - "container.cloud.google.com"
          - "gcr.io"
          - "*.gcr.io"
          args:
          - --v=4
          defaultCacheDuration: 1m