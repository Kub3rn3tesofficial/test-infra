- job-template:
    name: 'kubernetes-anywhere-e2e-{suffix}'
    node: '{jenkins_node}'
    description: '{description} Test owner: {test-owner}.'
    jenkins_node: 'e2e'
    disabled: '{obj:disable_job}'
    properties:
    - build-discarder:
        days-to-keep: 7
    kubernetes-anywhere-runner: bash <(curl -fsS --retry 3  "https://raw.githubusercontent.com/mikedanese/kubernetes-anywhere/master/util/e2e-runner.sh")
    builders:
    - activate-gce-service-account
    - shell: |
        {job-env}
        {post-env}
        timeout -k {kill-timeout}m {timeout}m {kubernetes-anywhere-runner} && rc=$? || rc=$?
        if [[ ${{rc}} -ne 0 ]]; then
            if [[ -x kubernetes/cluster/log-dump.sh && -d _artifacts ]]; then
                echo "Dumping logs for any remaining nodes"
                ./kubernetes/cluster/log-dump.sh _artifacts
            fi
        fi
        {report-rc}
    scm:
    - git:
        branches:
        - master
        browser: githubweb
        browser-url: https://github.com/kubernetes/kubernetes-anywhere
        git-basedir: go/src/k8s.io/kubernetes-anywhere
        skip-tag: true
        url: https://github.com/kubernetes/kubernetes-anywhere
        wipe-workspace: false
    wrappers:
    - ansicolor:
        colormap: xterm
    - e2e-credentials-binding
    - timeout:
        timeout: '{jenkins-timeout}'
        fail: true
    - timestamps
    - workspace-cleanup:
        dirmatch: true
        external-deletion-command: 'sudo rm -rf %s'
    publishers:
    - claim-build
    - junit-publisher
    - log-parser
    - gcs-uploader

- project:
    name: kubernetes-anywhere-e2e-gce-master
    test-owner: 'mikedanese'
    suffix:
    - 'gce':  # kubernetes-anywhere-e2e-gce
        cron-string: '{sq-cron-string}'
        description: 'Runs all conformance test on a kubernetes-anywhere cluster.'
        timeout: 50  # See #21138
        job-env: |
            export GINKGO_TEST_ARGS="--ginkgo.focus=\[Conformance\]"
    jobs:
    - 'kubernetes-anywhere-e2e-{suffix}'
