- job-template:
    name: 'kubernetes-e2e-{aws-suffix}'
    node: '{jenkins_node}'
    description: '{description} Test owner: {test-owner}.'
    jenkins_node: 'e2e'
    disabled: '{obj:disable_job}'
    properties:
        - build-discarder:
            days-to-keep: 7
    triggers:
        - reverse:
            jobs: '{trigger-job}'
            result: success
        - timed: '{cron-string}'
    publishers:
        - claim-build
        - junit-publisher
        - log-parser
        - email-ext:
            recipients: '{emails}'
        - gcs-uploader
    provider-env: aws
    builders:
        - activate-gce-service-account
        - shell: |
            export KUBEKINS_PROVIDER_ENV="{provider-env}.env"
            export KUBEKINS_JOB_ENV="{job-name}.env"
            {post-env}
            timeout -k {kill-timeout}m {timeout}m {runner} && rc=$? || rc=$?
            {report-rc}
    scm:
        - git:
            branches:
                - master
            browser: githubweb
            browser-url: https://github.com/kubernetes/test-infra
            basedir: go/src/k8s.io/test-infra
            skip-tag: true
            url: https://github.com/kubernetes/test-infra
            wipe-workspace: false
    wrappers:
        - ansicolor:
            colormap: xterm
        - e2e-credentials-binding
        - timeout:
            timeout: '{jenkins-timeout}'
            fail: true
        - timestamps
        - workspace-cleanup:
            dirmatch: true
            external-deletion-command: 'sudo rm -rf %s'

- project:
    name: kubernetes-aws
    test-owner: 'zmerlynn'
    emails: 'zml@google.com'
    timeout: 240
    aws-suffix:
        - 'aws':  # kubernetes-e2e-aws
            description: 'Run e2e tests on AWS using the latest successful Kubernetes build.'
            cron-string: '{sq-cron-string}'
            trigger-job: 'kubernetes-build'
            # See https://github.com/kubernetes/kubernetes/issues/30312 for why HPA is disabled.
            # See https://github.com/kubernetes/node-problem-detector/issues/28 for why NPD is disabled.
            job-env: |
                export E2E_NAME="e2e-aws-master"
                export GINKGO_TEST_ARGS="--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|\[HPA\]|NodeProblemDetector"
                export GINKGO_PARALLEL="y"
                export PROJECT="k8s-jkns-e2e-aws"
        - 'aws-release-1.3':  # kubernetes-e2e-aws-release-1.3
            description: 'Run e2e tests on AWS using the latest successful 1.3 Kubernetes build.'
            cron-string: '@daily'
            trigger-job: 'kubernetes-build-1.3'
            job-env: |
                export E2E_NAME="e2e-aws-1-3"
                export JENKINS_PUBLISHED_VERSION="ci/latest-1.3"
                export GINKGO_TEST_ARGS="--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\]|\[HPA\]|NodeProblemDetector"
                export GINKGO_PARALLEL="y"
                export PROJECT="k8s-jkns-e2e-aws"
    job-name: 'kubernetes-e2e-{aws-suffix}'
    jobs:
        - 'kubernetes-e2e-{aws-suffix}'
