- publisher:
    name: gcs-uploader
    publishers:
    - postbuildscript:
        builders:
        - shell: |
            mkdir -p _tmp
            curl -fsS --retry 3 "https://raw.githubusercontent.com/kubernetes/kubernetes/master/hack/jenkins/upload-to-gcs.sh" > ./_tmp/upload-to-gcs.sh
            chmod +x ./_tmp/upload-to-gcs.sh

            if [[ ! -e "${WORKSPACE}/build-log.txt" ]]; then
              curl -fsS --retry 3 "http://jenkins-master:8080/job/${JOB_NAME}/${BUILD_NUMBER}/consoleText" > "${WORKSPACE}/build-log.txt"
            fi
        - conditional-step:
            condition-best: SUCCESS
            condition-kind: current-status
            condition-worst: SUCCESS
            steps:
            - shell: JENKINS_BUILD_FINISHED=SUCCESS ./_tmp/upload-to-gcs.sh
        - conditional-step:
            condition-best: UNSTABLE
            condition-kind: current-status
            condition-worst: UNSTABLE
            steps:
            - shell: JENKINS_BUILD_FINISHED=UNSTABLE ./_tmp/upload-to-gcs.sh
        - conditional-step:
            condition-best: FAILURE
            condition-kind: current-status
            condition-worst: FAILURE
            steps:
            - shell: JENKINS_BUILD_FINISHED=FAILURE ./_tmp/upload-to-gcs.sh
        - conditional-step:
            condition-best: ABORTED
            condition-kind: current-status
            condition-worst: ABORTED
            steps:
            - shell: JENKINS_BUILD_FINISHED=ABORTED ./_tmp/upload-to-gcs.sh
        script-only-if-failed: false
        script-only-if-succeeded: false
- publisher:
    name: log-parser
    publishers:
    - logparser:
        fail-on-error: false
        parse-rules: /jenkins-master-data/log_parser_rules.txt
        unstable-on-warning: false

