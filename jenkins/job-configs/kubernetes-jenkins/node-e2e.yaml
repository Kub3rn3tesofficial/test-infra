- job-template:
    builders:
    - docker-build-publish:
        credentialsId: 1f361efb-5b85-4f61-91a7-4ec7fb2a5c23
        dockerfilePath: go/src/{gitbasedir}/{dockerfilePath}
        repoName: '{repoName}'
        tag: canary
    description: 'Build and push {gitproject} docker image.<br>Test Owner: {owner}.'
    disabled: '{obj:disable_job}'
    name: '{gitproject}-dockercanarybuild-ci'
    node: node
    properties:
    - build-discarder:
        num-to-keep: 200
    publishers:
    - claim-build
    - log-parser
    - email-ext:
        recipients: '{owner}'
    - gcs-uploader
    scm:
    - git:
        basedir: go/src/{gitbasedir}
        branches:
        - master
        browser: githubweb
        browser-url: https://github.com/{repoName}
        skip-tag: true
        url: https://github.com/{repoName}
    triggers:
    - pollscm:
        cron: H/5 * * * *
    - timed: '@daily'
    wrappers:
    - ansicolor:
        colormap: xterm
    - timeout:
        fail: true
        timeout: 30
    - timestamps
- job-template:
    builders:
    - shell: |
        #!/bin/bash
        set -e
        set -x
        cd go/src/{gitbasedir}
        {shell}
    description: '{gitproject} continuous e2e tests.<br>Test Owner: {owner}.'
    disabled: '{obj:disable_job}'
    name: '{gitproject}-gce-e2e-ci'
    node: node
    properties:
    - build-discarder:
        num-to-keep: 200
    publishers:
    - claim-build
    - junit-publisher-fully-specified:
        allow-empty-results: true
    - gcs-uploader
    - log-parser
    - email-ext:
        recipients: '{owner}'
    - gcs-uploader
    scm:
    - git:
        basedir: go/src/{gitbasedir}
        branches:
        - master
        browser: githubweb
        browser-url: https://github.com/{repoName}
        skip-tag: true
        url: https://github.com/{repoName}
    triggers:
    - pollscm:
        cron: H/5 * * * *
    - timed: H/30 * * * *
    wrappers:
    - ansicolor:
        colormap: xterm
    - timeout:
        fail: true
        timeout: 90
    - timestamps
    - inject:
        properties-content: |
          GOROOT=/usr/local/go
          GOPATH=$WORKSPACE/go
          PATH=$PATH:$GOROOT/bin:$WORKSPACE/go/bin
    - workspace-cleanup:
        dirmatch: true
        external-deletion-command: sudo rm -rf %s
- project:
    gitproject:
    - cadvisor:
        dockerfilePath: deploy/canary/Dockerfile
        gitbasedir: github.com/google/cadvisor
        owner: stclair@google.com
        repoName: google/cadvisor
    - heapster:
        dockerfilePath: deploy/docker/canary/Dockerfile
        gitbasedir: k8s.io/heapster
        owner: pszczesniak@google.com
        repoName: kubernetes/heapster
    jobs:
    - '{gitproject}-dockercanarybuild-ci'
    name: node-docker-canary-build
    repoName: google/cadvisor
    wrappers:
    - workspace-cleanup:
        dirmatch: true
        external-deletion-command: sudo rm -rf %s
- project:
    gitproject:
    - cadvisor:
        gitbasedir: github.com/google/cadvisor
        owner: stclair@google.com
        repoName: google/cadvisor
        shell: |
          go get -u github.com/tools/godep

          ./build/presubmit.sh
          godep go build -tags test github.com/google/cadvisor/integration/runner
          ./runner --logtostderr --test-retry-count=8 --test-retry-whitelist=integration/runner/retrywhitelist.txt \
          --ssh-options "-i /home/jenkins/.ssh/google_compute_engine -o UserKnownHostsFile=/dev/null -o IdentitiesOnly=yes -o CheckHostIP=no -o StrictHostKeyChecking=no" \
          e2e-cadvisor-ubuntu-trusty \
          e2e-cadvisor-coreos-beta \
          e2e-cadvisor-container-vm-v20151215 \
          e2e-cadvisor-container-vm-v20160127 \
          e2e-cadvisor-rhel-7
    - heapster:
        disable_job: true
        gitbasedir: k8s.io/heapster
        owner: pszczesniak@google.com
        repoName: kubernetes/heapster
        shell: make test-unit test-integration
    - kubelet:
        cron-string: '{sq-cron-string}'
        gitbasedir: k8s.io/kubernetes
        owner: pwittroc@google.com
        repoName: kubernetes/kubernetes
        shell: test/e2e_node/jenkins/e2e-node-jenkins.sh test/e2e_node/jenkins/jenkins-ci.properties
    jobs:
    - '{gitproject}-gce-e2e-ci'
    name: node-gce-e2e
    repoName: google/cadvisor

