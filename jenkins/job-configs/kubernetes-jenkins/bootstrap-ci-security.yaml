- job-template:
    builders:
    - shell: |
        # TODO(fejta): consider a stable tag instead of master
        git clone https://github.com/kubernetes/test-infra -b master
        './test-infra/jenkins/bootstrap.py' \
            --bare \
            --job='{job-name}' \
            --json \
            --root="${{GOPATH}}/src/k8s.io" \
            --service-account="${{GOOGLE_APPLICATION_CREDENTIALS}}" \
            --timeout='{timeout}' \
            --upload='gs://kubernetes-security-jenkins/logs' \
            --ssh="${{K8S_SECURITY_SSH_PRIVATE_KEY_FILE}}"
    disabled: false
    name: 'ci-security-{suffix}'
    node: 'e2e'
    use-blocker: false
    blocker: ''
    properties:
    - build-blocker:
        use-build-blocker: '{use-blocker}'
        blocking-jobs:
        - '{blocker}'
        queue-scanning: DISABLED
    - build-discarder:
        days-to-keep: 7
    triggers:
    - reverse:
        jobs: '{trigger-job}'
        result: success
    wrappers:
    - e2e-credentials-binding
    - credentials-binding:
      - file:
          credential-id: 'k8s-security-repo-git-ssh-key'
          variable: 'K8S_SECURITY_SSH_PRIVATE_KEY_FILE'
    - inject:
        properties-content: |
            GOROOT=/usr/local/go
            GOPATH=$WORKSPACE/go
            PATH=$PATH:$GOROOT/bin:$WORKSPACE/go/bin
    - timeout:
        timeout: '{jenkins-timeout}'
        fail: true
    - workspace-cleanup:  # cleanup before the job starts, for clean build.
        dirmatch: true
        exclude:
        - '**/.git/'
        external-deletion-command: 'sudo rm -rf %s'
    publishers:
    - workspace-cleanup:  # cleanup after job finishes, to not waste space.
        dirmatch: true
        exclude:
        - '**/.git/'
        external-deletion-command: 'sudo rm -rf %s'

- project:
    jobs:
    - 'ci-security-{suffix}'
    name: bootstrap-ci-security
    suffix:
    # START AWS
    - kubernetes-e2e-aws-release-1.5:
        job-name: ci-kubernetes-e2e-aws-release-1.5
        jenkins-timeout: 240
        timeout: 140
        trigger-job: 'ci-security-kubernetes-build-1.5'
    # END AWS

    # START GCE
    # gce-1.5
    - kubernetes-e2e-gce-release-1.5:
        job-name: ci-kubernetes-e2e-gce-release-1.5
        jenkins-timeout: 170
        timeout: 70
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gce-etcd3-release-1.5:
        job-name: ci-kubernetes-e2e-gce-etcd3-release-1.5
        jenkins-timeout: 170
        timeout: 70
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gce-reboot-release-1.5:
        job-name: ci-kubernetes-e2e-gce-reboot-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gce-slow-release-1.5:
        job-name: ci-kubernetes-e2e-gce-slow-release-1.5
        jenkins-timeout: 270
        timeout: 170
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gce-serial-release-1.5:
        job-name: ci-kubernetes-e2e-gce-serial-release-1.5
        jenkins-timeout: 420
        timeout: 320
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gce-alpha-features-release-1.5:
        job-name: ci-kubernetes-e2e-gce-alpha-features-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gce-scalability-release-1.5:
        job-name: ci-kubernetes-e2e-gce-scalability-release-1.5
        jenkins-timeout: 240
        timeout: 140
        trigger-job: 'ci-security-kubernetes-build-1.5'
        use-blocker: true
        blocker: 'ci-kubernetes-e2e-gce-scalability-release-1.6'
    - kubernetes-e2e-gce-federation-release-1.5:
        job-name: ci-kubernetes-e2e-gce-federation-release-1.5
        jenkins-timeout: 850
        timeout: 750 # See the discussion here - https://github.com/kubernetes/test-infra/pull/1280 for the motivation behind the choice of this value.
        trigger-job: 'ci-security-kubernetes-build-1.5'

    # gci-gce-1.5
    - kubernetes-e2e-gci-gce-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-release-1.5
        jenkins-timeout: 170
        timeout: 70
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gce-reboot-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-reboot-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gce-slow-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-slow-release-1.5
        jenkins-timeout: 270
        timeout: 170
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gce-serial-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-serial-release-1.5
        jenkins-timeout: 420
        timeout: 320
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gce-ingress-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-ingress-release-1.5
        jenkins-timeout: 210
        timeout: 110
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gce-alpha-features-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-alpha-features-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gce-scalability-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gce-scalability-release-1.5
        jenkins-timeout: 240
        timeout: 140
        trigger-job: 'ci-security-kubernetes-build-1.5'
        use-blocker: true
        blocker: 'ci-kubernetes-e2e-gci-gce-scalability-release-1.6'
    # END GCE

    # START GCE-GCI
    - kubernetes-e2e-gce-gci-ci-release-1.5:
        job-name: ci-kubernetes-e2e-gce-gci-ci-release-1.5
        jenkins-timeout: 170
        timeout: 70
        trigger-job: 'ci-security-kubernetes-build-1.5'

    - kubernetes-e2e-gce-gci-ci-serial-release-1.5:
        job-name: ci-kubernetes-e2e-gce-gci-ci-serial-release-1.5
        jenkins-timeout: 420
        timeout: 320
        trigger-job: 'ci-security-kubernetes-build-1.5'

    - kubernetes-e2e-gce-gci-ci-slow-release-1.5:
        job-name: ci-kubernetes-e2e-gce-gci-ci-slow-release-1.5
        jenkins-timeout: 270
        timeout: 170
        trigger-job: 'ci-security-kubernetes-build-1.5'
    # END GCE-GCI


    # START GKE
    # gke-1.5
    - kubernetes-e2e-gke-release-1.5:
        job-name: ci-kubernetes-e2e-gke-release-1.5
        jenkins-timeout: 170
        timeout: 70
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gke-serial-release-1.5:
        job-name: ci-kubernetes-e2e-gke-serial-release-1.5
        jenkins-timeout: 420
        timeout: 320
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gke-alpha-features-release-1.5:
        job-name: ci-kubernetes-e2e-gke-alpha-features-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gke-slow-release-1.5:
        job-name: ci-kubernetes-e2e-gke-slow-release-1.5
        jenkins-timeout: 270
        timeout: 170
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gke-reboot-release-1.5:
        job-name: ci-kubernetes-e2e-gke-reboot-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'

    # gci-gke-1.5
    - kubernetes-e2e-gci-gke-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gke-release-1.5
        jenkins-timeout: 170
        timeout: 70
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gke-serial-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gke-serial-release-1.5
        jenkins-timeout: 420
        timeout: 320
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gke-slow-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gke-slow-release-1.5
        jenkins-timeout: 280
        timeout: 170
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gke-reboot-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gke-reboot-release-1.5
        jenkins-timeout: 300
        timeout: 200
        trigger-job: 'ci-security-kubernetes-build-1.5'
    - kubernetes-e2e-gci-gke-ingress-release-1.5:
        job-name: ci-kubernetes-e2e-gci-gke-ingress-release-1.5
        jenkins-timeout: 220
        timeout: 110
        trigger-job: 'ci-security-kubernetes-build-1.5'
    # END GKE

    # START KUBEMARK
    - kubernetes-kubemark-5-gce-1.5:
        job-name: ci-kubernetes-kubemark-5-gce-1.5
        jenkins-timeout: 180
        timeout: 80
        trigger-job: 'ci-security-kubernetes-build-1.5'
    # END KUBEMARK
