apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "fullname" . }}
data:
  config.yaml: |-
    ---
    plank:
      job_url_template: '{{ template "job_url_template" . }}'
      report_template: '{{ template "report_template" . }}'
      
    triggers:
    - repos:
      {{ range .Values.repos }}
      - {{ . }}
      {{ end }}
      trusted_org: {{ .Values.trustedOrg }}
      
    presubmits:
      
      {{ range .Values.repos }}
      {{ . }}:
      - name: "{{ . }}-pipeline"
        always_run: true
        context: "Jenkins GCE e2e"
        rerun_command: "@prow go"
        trigger: "@prow go"
      {{ end }}
      
    postsubmits:
    periodics:
      - name: metrics-bigquery
        interval: 24h
        spec:
          containers:
          - image: gcr.io/k8s-testimages/bigquery:0.1
            env:
            - name: GOOGLE_APPLICATION_CREDENTIALS
              value: /ectc/service-account/service-account.json
            volumeMounts:
            - name: service
              mountPath: /etc/service-account
              readOnly: true
          volumes:
          - name: service
            secret:
              secretName: triage-service-account
  plugins.yaml: |-
      # Plugin repository whitelist.
      # Keys: Full repo name: "org/repo.
      # Values: List of plugins to run against the repo.
      ---
      {{ range .Values.repos }}
      {{ . }}:
      - assign
      - trigger
      - label
      - close
      - heart
      - lgtm
      - yuks
      - reopen
      
      {{ end }}