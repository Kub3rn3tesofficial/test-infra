presubmits:
  kubernetes-csi/csi-driver-host-path:
  - name: pull-sig-storage-csi-driver-host-path
    always_run: false
    decorate: true
    skip_report: false
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      # We need this image because it has Docker and kind.
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20190220-615bdbe2e-master
        command:
        - runner.sh
        args:
        - ./.prow.sh
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        # kind needs /lib/modules and cgroups from the host
        volumeMounts:
        - mountPath: /lib/modules
          name: modules
          readOnly: true
        - mountPath: /sys/fs/cgroup
          name: cgroup
        # Resource specification copied from config/jobs/kubernetes/sig-cluster-lifecycle/kubeadm-kind.yaml.
        # This job might be similar (to be checked).
        resources:
          requests:
            # these are both a bit below peak usage during build
            # this is mostly for building kubernetes
            memory: "9000Mi"
            # during the tests more like 3-20m is used
            cpu: 2000m
      volumes:
      - name: modules
        hostPath:
          path: /lib/modules
          type: Directory
      - name: cgroup
        hostPath:
          path: /sys/fs/cgroup
          type: Directory
