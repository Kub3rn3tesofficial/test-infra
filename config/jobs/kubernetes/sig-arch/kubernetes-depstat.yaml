presubmits:
  kubernetes/kubernetes:
  - name: kubernetes-depstat
    decorate: true
    always_run: true
    skip_report: true
    spec:
      containers:
      - image: golang
        command: ["/bin/bash"]
        args: ["-c", "apk update; apk add git; 
          set -euo; 
          BASE_SHA="${PULL_BASE_SHA:-""}"; ARTIFACTS="${ARTIFACTS:-tmp/artifacts}";
          mkdir -p "${ARTIFACTS}";
          export GO111MODULE=on;
          go get github.com/kubernetes-sigs/depstat;
          function write_report() { depstat stats --json };
          function diff_reports() { diff $1 $2 };
          write_report > "${ARTIFACTS}/stats.json";
          if [ -n "${BASE_SHA}" ]; then;
          git checkout -b base "${BASE_SHA}";
          write_report > "${ARTIFACTS}/stats-base.json";
          diff_reports "${ARTIFACTS}"/report{-base}.json;  
          fi;"]
