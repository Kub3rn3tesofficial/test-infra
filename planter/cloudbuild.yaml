steps:
  - name: gcr.io/kaniko-project/executor
    args:
    - '--destination'
    - 'gcr.io/$PROJECT_ID/planter:$_BAZEL_VERSION'
    - '--build-arg'
    - 'BAZEL_VERSION=$_BAZEL_VERSION'
    - '--cache=true'
    - '--cache-ttl=6h'
    - '--context=.'
    dir: planter/
  - name: gcr.io/kaniko-project/executor
    - '--destination'
    - 'gcr.io/$PROJECT_ID/planter:$_BAZEL_VERSION-cross'
    - '--dockerfile'
    - 'Dockerfile-cross'
    - '--build-arg'
    - 'BASEIMAGE=gcr.io/$PROJECT_ID/planter:$_BAZEL_VERSION',
    - '--cache=true'
    - '--cache-ttl=6h'
    - '--context=.'
    dir: planter/
substitutions:
  _BAZEL_VERSION: '0.25.2'
options:
  substitution_option: ALLOW_LOOSE  # because _GIT_TAG is provided but not used.
