events {
  worker_connections  1024;
}

http {
  # use 2 directory levels for cache storage.
  # 100mb of cache-key memory
  # no 'max_size' value => use all available disk space for caching.
  # delete cache entries after 48h
  # write cache files directly to their cache location instead of moving them
  proxy_cache_path /cache levels=1:2 keys_zone=my_cache:100m inactive=48h use_temp_path=off;
  server {
    proxy_cache my_cache; # enables the cache
    listen 80;
    location / {
        if ($http_user_agent ~ (GoogleHC) ) {
          return 200;
        }
        proxy_cache_revalidate on; # use Last-Modified headers
        proxy_cache_lock on; # serialize requests for uncached items so that only first request costs a token.
        proxy_pass https://api.github.com;
    }
  }
}
