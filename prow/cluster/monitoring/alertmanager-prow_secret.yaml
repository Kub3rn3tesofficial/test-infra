# Please replace '{{ api_url }}' below with the URL of slack incoming hook
# before `kubectl apply -f`
apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-prow
  namespace: prow-monitoring
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m

    route:
      group_by: ['alertname', 'job']
      group_wait: 5m
      group_interval: 30m
      repeat_interval: 6h
      receiver: 'slack-notifications'

    receivers:
    - name: 'slack-notifications'
      slack_configs:
      - channel: '#testing-ops'
        api_url: '{{ api_url }}'
        icon_url: https://avatars3.githubusercontent.com/u/3380462
        text: '{{ template "custom_slack_text" . }}'
        link_names: true

    templates:
    - '*.tmpl'
  msg.tmpl: |
    {{ define "custom_slack_text" }}{{ .CommonAnnotations.message }}{{ end }}
type: Opaque
